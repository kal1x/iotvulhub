# TP-Link WR940N 远程代码执行漏洞（CVE-2017-13772）

## 漏洞环境

- docker：攻击、调试主机：192.168.2.1
- qemu-system：固件主机：192.168.2.2
- httpd（有漏洞 Web 服务器）：192.168.2.2:80
- 镜像依赖：
  - `firmianay/ubuntu1604 -> firmianay/qemu-system:mips`
  - `firmianay/ubuntu1604 -> firmianay/binwalk:noentry -> firmianay/firmadyne（或者 firmianay/firmae）`

使用 `firmianay/binwalk` 解压固件：

```sh
$ docker run --rm -v $PWD/firmware/:/root/firmware firmianay/binwalk -Mer "/root/firmware/wr940nv4_us_3_16_9_up_boot(160617).bin"
```

构建并启动漏洞环境：

```sh
# 初始化环境
$ ./init_env.sh mips

# 构建镜像
$ docker-compose -f docker-compose-firmadyne.yml build

# 启动容器，账号/密码 root/sohoadmin
$ docker-compose -f docker-compose-firmadyne.yml up

# 启动完成后，开启 socks 代理
$ ssh -D 2345 root@127.0.0.1 -p 1234
# 配置浏览器代理，即可登陆 Web 后台 http://192.168.2.2/

# 漏洞利用
$ python3 tools/exp.py
```

## 漏洞复现

## Exploit

```py

```

## 参考链接

- <https://www.exploit-db.com/exploits/43022>
- <https://mp.weixin.qq.com/s/_ZpMcj9EOdopyH7BusKe9A>
- <https://fidusinfosec.com/tp-link-remote-code-execution-cve-2017-13772>
